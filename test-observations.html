<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Observation Test Page</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .btn {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      font-size: 14px;
    }

    .btn-primary { background: #007bff; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-danger { background: #dc3545; color: white; }

    /* Modal styles */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 0;
      border-radius: 8px;
      z-index: 1001;
      min-width: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 18px;
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    /* Toast styles */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 2000;
    }

    .toast {
      background: #333;
      color: white;
      padding: 15px 20px;
      border-radius: 4px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .toast.success { background: #28a745; }
    .toast.error { background: #dc3545; }

    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    .test-section h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <h1>Observation Test Page</h1>
  <p>Use this page to test DOM observation capture. Elements are dynamically created to trigger MutationObserver.</p>

  <!-- Test Section 1: Modal Dialog (Dynamically Created) -->
  <div class="test-section">
    <h3>Test 1: Modal Dialog (Dynamic)</h3>
    <p>Creates and appends modal to DOM - should trigger observation with children.</p>
    <button class="btn btn-primary" onclick="openDynamicModal()">Open Dynamic Modal</button>
  </div>

  <!-- Test Section 2: Toast Notifications -->
  <div class="test-section">
    <h3>Test 2: Toast Notifications</h3>
    <p>Creates toast elements dynamically.</p>
    <button class="btn btn-success" onclick="showToast('success')">Success Toast</button>
    <button class="btn btn-danger" onclick="showToast('error')">Error Toast</button>
  </div>

  <!-- Test Section 3: Alert Banner (Dynamic) -->
  <div class="test-section">
    <h3>Test 3: Dynamic Alert Banner</h3>
    <p>Creates an alert banner dynamically with interactive elements.</p>
    <button class="btn btn-primary" onclick="showDynamicAlert()">Show Dynamic Alert</button>
    <div id="alertContainer"></div>
  </div>

  <!-- Test Section 4: Delayed Modal -->
  <div class="test-section">
    <h3>Test 4: Delayed Modal (200ms)</h3>
    <p>Creates modal after 200ms delay - should have delay_ms attribute.</p>
    <button class="btn btn-primary" onclick="openDelayedModal()">Open Delayed Modal</button>
  </div>

  <!-- Container for dynamic modal -->
  <div id="modalContainer"></div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <script>
    // Dynamic Modal - creates elements and appends to DOM
    function openDynamicModal() {
      const container = document.getElementById('modalContainer');

      // Create backdrop
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      backdrop.id = 'dynamicBackdrop';
      backdrop.onclick = closeDynamicModal;

      // Create modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.id = 'dynamicModal';
      modal.setAttribute('role', 'dialog');
      modal.setAttribute('aria-labelledby', 'dynamicModalTitle');
      modal.setAttribute('aria-modal', 'true');

      modal.innerHTML = `
        <div class="modal-header">
          <h2 id="dynamicModalTitle">Shopping Cart</h2>
          <button class="close-btn" onclick="closeDynamicModal()" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <p>Your cart contains 3 items totaling $49.99.</p>
          <p>Would you like to proceed to checkout?</p>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeDynamicModal()">Cancel</button>
          <button class="btn btn-primary" onclick="checkoutAction()">Checkout</button>
          <button class="btn btn-success" onclick="continueShoppingAction()">Continue Shopping</button>
        </div>
      `;

      // Append to DOM (this triggers MutationObserver)
      container.appendChild(backdrop);
      container.appendChild(modal);
    }

    function closeDynamicModal() {
      const backdrop = document.getElementById('dynamicBackdrop');
      const modal = document.getElementById('dynamicModal');
      if (backdrop) backdrop.remove();
      if (modal) modal.remove();
    }

    function checkoutAction() {
      alert('Proceeding to checkout...');
      closeDynamicModal();
    }

    function continueShoppingAction() {
      closeDynamicModal();
    }

    // Delayed modal
    function openDelayedModal() {
      setTimeout(() => {
        openDynamicModal();
      }, 200);
    }

    // Toast functions (already dynamic)
    function showToast(type) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.setAttribute('role', 'alert');
      toast.setAttribute('aria-live', 'polite');

      const icon = type === 'success' ? '✓' : '✗';
      const message = type === 'success' ? 'Operation completed successfully!' : 'An error occurred. Please try again.';

      toast.innerHTML = `
        <span>${icon}</span>
        <span>${message}</span>
        <button onclick="this.parentElement.remove()" style="background:none;border:none;color:white;cursor:pointer;margin-left:10px;">×</button>
      `;

      container.appendChild(toast);

      // Auto-remove after 10 seconds (longer for testing)
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 10000);
    }

    // Dynamic Alert Banner
    function showDynamicAlert() {
      const container = document.getElementById('alertContainer');

      // Remove existing alert if any
      const existing = document.getElementById('dynamicAlert');
      if (existing) {
        existing.remove();
        return;
      }

      const alert = document.createElement('div');
      alert.id = 'dynamicAlert';
      alert.setAttribute('role', 'alert');
      alert.setAttribute('aria-live', 'polite');
      alert.style.cssText = 'padding: 15px 20px; border-radius: 4px; margin: 10px 0; background: #cce5ff; color: #004085; border: 1px solid #b8daff;';

      alert.innerHTML = `
        <strong>Information:</strong> This is an important dynamically created message.
        <button class="btn btn-primary" onclick="alertActionDynamic()">Take Action</button>
        <button class="btn" onclick="dismissDynamicAlert()">Dismiss</button>
      `;

      container.appendChild(alert);
    }

    function dismissDynamicAlert() {
      const alert = document.getElementById('dynamicAlert');
      if (alert) alert.remove();
    }

    function alertActionDynamic() {
      alert('Action taken on dynamic alert!');
    }
  </script>
</body>
</html>
